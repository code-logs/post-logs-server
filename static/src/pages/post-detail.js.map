{"version":3,"file":"post-detail.js","sourceRoot":"","sources":["../../../src/pages/post-detail.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html } from 'lit'\nimport { customElement, property } from 'lit/decorators.js'\nimport { apis } from '../apis/index.js'\nimport '../components/markdown-view-editor/markdown-view-editor.js'\nimport '../components/now-loading/now-loading.js'\n// eslint-disable-next-line import/no-duplicates\nimport { PostInfo } from '../components/post-info/post-info.js'\n// eslint-disable-next-line import/no-duplicates\nimport '../components/post-info/post-info.js'\nimport { buttonBoxStyle } from '../components/styles/styles.js'\nimport { Post } from '../types/post.js'\nimport { PageElement } from './abstracts/page-element.js'\nimport { navigate } from '../components/dom-router/dom-router.js'\nimport { debounce } from '../utils/debounce.js'\n\n@customElement('post-detail')\nexport class PostDetail extends PageElement {\n  pageTitle: string = ''\n\n  @property({ type: Boolean })\n  enablePreview?: boolean = false\n\n  @property({ type: String })\n  postFileName?: string\n\n  @property({ type: Object })\n  post?: Post\n\n  @property({ type: String })\n  private content?: string\n\n  static styles = css`\n    ${buttonBoxStyle}\n    section#post-detail {\n      display: grid;\n      grid-template-columns: 1fr;\n      gap: 10px;\n    }\n  `\n\n  constructor() {\n    super()\n    this.postFileName = window.location.pathname.replace(/^\\/posts\\//g, '')\n    if (!this.postFileName) window.location.href = '/'\n    this.pageTitle = `Post Logs | ${this.postFileName}`\n  }\n\n  private get postInfo() {\n    const postInfo = this.renderRoot.querySelector<PostInfo>('post-info')\n    if (!postInfo) throw new Error('No post info element found')\n\n    return postInfo\n  }\n\n  protected firstUpdated(): void {\n    if (this.postFileName) this.fetchPost(this.postFileName)\n  }\n\n  async fetchPost(postFileName: string) {\n    this.post = await apis.getPost(postFileName)\n  }\n\n  private async deletePost() {\n    if (!this.post?.fileName) throw new Error('No post fileName found')\n    const answer = window.confirm('포스팅을 삭제할까요?')\n    if (answer) await apis.deletePost(this.post.fileName)\n    alert('포스팅이 삭제 됐습니다.')\n    navigate('/')\n  }\n\n  private async updatePost() {\n    try {\n      const postId = this.post?.id\n      if (!postId) throw new Error('포스팅 아이디를 찾을 수 없습니다.')\n      const content = this.content || this.post?.content\n      if (!content) throw new Error('작성된 포스팅이 없습니다.')\n\n      const { tempPost, thumbnail } = this.postInfo.serialize()\n\n      const answer = window.confirm('포스팅의 변경사항을 저장할까요?')\n      if (!answer) return\n\n      await apis.updatePost(postId, tempPost, content, thumbnail)\n\n      alert('포스팅이 저장 됐습니다.')\n      navigate('/')\n    } catch (e) {\n      if (e instanceof Error) {\n        alert(e.message)\n      } else {\n        alert('Unexpected error occurred')\n      }\n\n      throw e\n    }\n  }\n\n  render() {\n    if (!this.post?.content) return html`<now-loading></now-loading>`\n\n    const valueChangeHandler = debounce((event: Event) => {\n      if (event instanceof CustomEvent) {\n        const { value } = (event as CustomEvent<{ value: string }>).detail\n        this.content = value\n      }\n    })\n\n    return html`\n      <section id=\"post-detail\">\n        <post-info\n          .post=${this.post}\n          .content=${this.content || this.post.content}\n        ></post-info>\n\n        <markdown-view-editor\n          enablePreview\n          @valueChange=${valueChangeHandler}\n          .content=${this.post.content}\n        ></markdown-view-editor>\n\n        <div class=\"button-container\">\n          ${this.post.isCreated\n            ? html`<button danger @click=${this.deletePost}>삭제</button>`\n            : ''}\n\n          <button @click=${this.updatePost}>저장</button>\n        </div>\n      </section>\n    `\n  }\n}\n"]}